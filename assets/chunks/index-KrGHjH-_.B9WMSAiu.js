import"./main.BZNmIPAh.js";import"./index.CLbBkQsP.js";import{_ as be,aA as N,u as ge,s as q,a as X,o as me,b1 as xe,d as E,g as $,k as P,aM as T,l as L,n as he,aO as Ce,b2 as we,b3 as Se,h as Pe,b4 as Te,b0 as ee,a3 as oe,p as Oe,b5 as te}from"./eo-dash.rBo9RIzu.js";import{i as Ne}from"./easing-CH0-9wR8.CTB3jml5.js";import Le from"./EodashMapBtns-C_jyUJ2x.DW1PVe_V.js";import{h as O,a2 as ae,p as k,aw as re,v as pe,c as H,o as W,j as B,e as Y,k as d,N as R,G as Me,x as ce,q as _e}from"./framework.DcHDDd1r.js";import"./addCommonStyleSheet.DgtOC_XX.js";import"./WMTS.BRGgbZwy.js";import"./Group.ovD7bfEG.js";import"./extent.B6zYA2nd.js";import"./GeoJSON.CT93eYMG.js";import"./index.Rf_EwgyP.js";import"./getElement.CdRlZPdn.js";import"./WKT.RZkrOSkj.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.Bx-rtsOD.js";import"./ExportState-BhjxS0jG.DPSTI9qt.js";import"./PopUp-CSPXdqKI.BpP_sUPr.js";import"./forwardRefs-BbvoXHtj.Clc9oudn.js";import"./transition-Ctkv90El.CahzmfcA.js";import"./VImg-FoXcOnWF.D5i2AZqw.js";import"./EodashItemFilter-BPMpnXjo.CIRlYVGr.js";import"./handling-DxucYlYh.Dnvo12Pd.js";import"./async-Dk79llLt.Bg5oZPgF.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.DHZgg1Fs.js";import"./index.BUIxO2d3.js";const se=async(e,o,c)=>{L.debug("Creating layers config",e,o,c);const a=[],r={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const u of o){let t;if(c){const s=typeof c=="string"?new Date(c):c;t=await u.createLayersJson(s)}else t=await u.createLayersJson(void 0);t.forEach(s=>{s.properties.layerControlExpand=!0,s.properties.layerControlToolsExpand=!0}),r.layers.push(...t)}a.push(r);const f=await te.getIndicatorLayers(e),y=te.getObservationPointsLayer(o);y&&r.layers.unshift(y);const i={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},b=f.filter(u=>u.properties.group==="baselayer");if(b.length){let u=0,t=0;for(let s=0;s<b.length;s++){const n=b[s];"visible"in n.properties||(n.properties.visible=!1),n.properties.visible&&(u++,t=s)}u===0&&(b[0].properties.visible=!0),u>0&&b.forEach((s,n)=>{n!==t?s.properties.visible=!1:s.properties.visible=!0}),i.layers.push(...b),i.layers.forEach(s=>{s.properties.layerControlExclusive=!0})}else i.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});i.layers.length&&a.push(i);const h={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},g=f.filter(u=>u.properties.group==="overlay");return g.length&&(h.layers.push(...g),a.unshift(h)),a};let U=null;const ke=(e,o)=>{const c=a=>{var i;const r=a.map,f=(i=e.value)==null?void 0:i.lonLatCenter,y=r==null?void 0:r.getView().getZoom();f&&!Number.isNaN(f[0])&&!Number.isNaN(f[1])&&!Number.isNaN(y)&&(o.value=[f[0],f[1],y])};pe(()=>{var a,r;(r=(a=e.value)==null?void 0:a.map)==null||r.on("moveend",c)}),ce(()=>{var a,r;(r=(a=e.value)==null?void 0:a.map)==null||r.un("moveend",c)})},ie=(e,o,c,a,r,f,y,i)=>{L.debug("InitMap",e.value,o.value,c.values,a.value);const h=_e(i?[o,a,i]:[o,a],async(g,u)=>{var C,V,F,G,J,j,I,l,p,x,v,_,w,A,K,Q;const[t,s,n]=i?g:[g[0],g[1],null],[M,D,m]=i?u:[u[0],u[1],null];if(t){L.debug("Selected Indicator watch triggered",t,s),((C=e==null?void 0:e.value)==null?void 0:C.id)==="main"&&U!==null&&((V=e==null?void 0:e.value)==null||V.map.setView(U),U=null);let S=[];const ue=(t==null?void 0:t.id)===(M==null?void 0:M.id)&&(s!==D||n&&(n==null?void 0:n.id)!==(m==null?void 0:m.id)),{selectedCompareStac:de}=q(X());if(((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"?await Te(t):de.value!==null&&(U=((G=e==null?void 0:e.value)==null?void 0:G.map.getView())??null,e.value.sync=f.value),ue){S=await se(t,c,n??s),L.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(S))),r.value=S,ee(((J=e.value)==null?void 0:J.id)==="compare"?"compareTime:updated":"time:updated",e.value,S);return}S=await se(t,c,i?n:s);let z=null;const Z=(I=(j=t==null?void 0:t.extent)==null?void 0:j.temporal)==null?void 0:I.interval;if(Z&&Z.length>0&&Z[0].length>1&&(z=new Date(Z[0][1]),L.debug("Indicator load: found stac extent, setting time to latest value",z)),!n&&z!==null&&z.toISOString()!==a.value&&!oe.value&&(a.value=z.toISOString()),y&&!n&&((l=e==null?void 0:e.value)==null?void 0:l.id)==="main"&&(p=t.extent)!=null&&p.spatial.bbox&&!(oe.value&&((x=N.value)!=null&&x[0])&&((v=N.value)!=null&&v[1]))){const fe=(_=t.extent)==null?void 0:_.spatial.bbox[0],ye=Oe([...fe]),ve=(K=e.value)==null?void 0:K.transformExtent(ye,"EPSG:4326",(A=(w=e.value)==null?void 0:w.map)==null?void 0:A.getView().getProjection());e.value.zoomExtent=ve}L.debug("Assigned layers",JSON.parse(JSON.stringify(S))),r.value=S,await ee(((Q=e.value)==null?void 0:Q.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,r.value)}},{immediate:!0});ce(()=>{h()})},ne=(e,o)=>{he(async(c,a)=>{if(c.includes("compare"))return;const r=[];for(const f of e)r.push(...await f.getToolTipProperties());o.value=r,L.debug("Updated tooltip properties",o.value)})},Be="#cursor-coordinates[data-v-9484a41e]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media (max-width: 959px){#cursor-coordinates[data-v-9484a41e]{display:none}}#scale-line[data-v-9484a41e]{position:fixed;left:24px;bottom:28px;color:#fff}@media (max-width: 959px){#scale-line[data-v-9484a41e]{bottom:102px}}[data-v-9484a41e] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-9484a41e] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-9484a41e]{position:fixed;top:0;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-9484a41e]>*{pointer-events:auto}",je=[".enabled"],Ie=[".center",".zoom",".layers",".controls"],ze=[".propertyTransform"],Ve=[".layers"],Fe=[".propertyTransform"],Ge={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Je={key:1,id:"scale-line",ref:"scale-line"};var le;const Ae={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=N.value)==null?void 0:e[0])??15,((o=N.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((le=N.value)==null?void 0:le[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var I;const o=e,{width:c}=ge(),a=l=>{if(typeof l=="number")return l;if(typeof l=="string"){const p=l.split("/"),x=c.value;return x<960?parseInt(p[0])||1:x<1920?parseInt(p[1]||p[0])||1:parseInt(p[2]||p[1]||p[0])||1}return 1},r=O(()=>a(o.btnsPosition.x)),f=O(()=>a(o.btnsPosition.y)),y=O(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),i=ae("scale-line"),b=ae("cursor-coords"),h=k([]),g=k([]),u=O(()=>{const l={Attribution:{collapsible:!0}};return o.enableScaleLine&&i.value&&(l.ScaleLine={target:i.value}),o.enableCursorCoordinates&&b.value&&(l.MousePosition={projection:"EPSG:4326",coordinateFormat:p=>`${p[1].toFixed(3)} °N, ${p[0].toFixed(3)} °E`,target:b.value}),l}),t=re(o.center),s=re(((I=N.value)==null?void 0:I[2])??o.zoom),n=k([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),M=k([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),D={duration:1200,easing:Ne},m=k(null),C=k(null),{selectedCompareStac:V}=q(X()),F=O(()=>o.enableCompare&&V.value?"":"first");ke(m,N),pe(()=>{const{selectedCompareStac:l,selectedStac:p,selectedItem:x}=q(X());me.value=m.value,o.enableCompare&&(xe.value=C.value),o.enableCompare&&(ie(C,l,Pe,E,M,m,!1),ne($,g)),ie(m,p,$,E,n,C,o.zoomToExtent,x)}),ne($,h);const G=O(()=>({visibility:h.value.length?"visible":"hidden"})),J=O(()=>({visibility:g.value.length?"visible":"hidden"})),j=l=>{const p=l==="main"?h:g,x=l=="main"?we:Se;return v=>{const _=JSON.parse(Ce.render(JSON.stringify(p.value),{...x.value??{}})),w=_==null?void 0:_.find(A=>A.id===v.key);if(w)return typeof v.value=="object"&&(v.value=JSON.stringify(v.value)),isNaN(Number(v.value))||(v.value=Number(v.value).toFixed(4).toString()),{key:w.title||w.id,value:v.value+" "+(w.appendix||"")}}};return(l,p)=>(W(),H("span",null,[B("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":F.value},[B("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:m,id:"main",".animationOptions":D,".center":d(t),".zoom":d(s),".layers":n.value,".controls":u.value},[B("eox-map-tooltip",{style:R(G.value),".propertyTransform":j("main")},null,44,ze)],40,Ie),B("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:C,".layers":M.value},[B("eox-map-tooltip",{style:R(J.value),".propertyTransform":j("compare")},null,44,Fe)],40,Ve)],40,je),e.enableCursorCoordinates?(W(),H("div",Ge,null,512)):Y("v-if",!0),e.enableScaleLine?(W(),H("span",Je,null,512)):Y("v-if",!0),B("div",{class:"map-buttons-container",style:R(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0`)},[Y(" prettier-ignore "),Me(Le,{style:R({gridColumn:d(P)||d(T)?r.value:"12",gridRow:f.value}),exportMap:d(P)||d(T)?y.value.exportMap:!1,changeProjection:d(P)||d(T)?y.value.changeProjection:!1,compareIndicators:d(P)||d(T)?y.value.compareIndicators:!1,backToPOIs:d(P)||d(T)?y.value.backToPOIs:!1,enableSearch:d(P)||d(T)?y.value.enableSearch:!1,enableZoom:d(P)||d(T)?y.value.enableZoom:!1},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])],4)]))}},go=be(Ae,[["styles",[Be]],["__scopeId","data-v-9484a41e"]]);export{go as default};
