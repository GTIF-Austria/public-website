import"./main.CQ1v6wzo.js";import"./index.-wbD_IVQ.js";import{_ as le,aw as O,u as pe,s as $,a as H,aU as ce,aV as ue,d as X,h as U,aC as fe,aF as de,l as I,aW as ye,aI as ve,aX as me,aY as be,i as ge,aZ as he,aT as Y,W as q,a_ as K}from"./eo-dash.B7T-qZ2i.js";import{i as xe,E as Ce}from"./EodashMapBtns-Bl8bZqyF.a3DCAoui.js";import{h as w,a2 as Q,p as M,av as E,v as ae,c as D,o as Z,j as N,e as W,k as G,N as R,b as Pe,x as se,q as we}from"./framework.CV862zv4.js";import"./addCommonStyleSheet.CH1Fdn6y.js";import"./Group.TOLTOuRh.js";import"./extent.Dy7YBqBe.js";import"./WMTS.DHUasXEy.js";import"./GeoJSON.CRUW1A8G.js";import"./index.Rf_EwgyP.js";import"./getElement.CdRlZPdn.js";import"./WKT.ChjBEC7E.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.koN_VtZd.js";import"./ExportState-f1EVEGRZ.AxK2iqIX.js";import"./PopUp-BlURZIXs.Dk2B7Ut9.js";import"./VOverlay-Dwdkmj_R.DS3kDt6H.js";import"./forwardRefs-MndIQ8yn.CTiud4Ej.js";import"./transition-D9Hb22fW.yE8EZp48.js";import"./index-BDy9Xju0.CvqKBkDH.js";import"./VImg-DTEQzWdl.CEfKpAlo.js";import"./EodashItemFilter-DJU8ZGKn.CLFPSgM_.js";import"./main.Bq8ByCWv.js";import"./unsafe-html.CFs6Hq_O.js";import"./directive.CvdRHFdJ.js";import"./when.BR7zwNJC.js";import"./repeat.mFBt84rW.js";import"./directive-helpers.BxH_FWrE.js";import"./index.BUIxO2d3.js";import"./static.DK6N5LQU.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./orient2d.DArCjZZA.js";import"./index.BSpBAx16.js";import"./handling-DUj09yow.nowiScFx.js";import"./async-ChALWMDu.KtWqmhGM.js";import"./utils.DZj92Qv1.js";import"./index-v-0N_Dar.CLGZBr_x.js";import"./VTooltip-C5sAKIJu.B2VbNG6t.js";const ee=async(e,o,p)=>{I.debug("Creating layers config",e,o,p);const r=[],a={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const f of o){let v;p?v=await f.createLayersJson(new Date(p)):v=await f.createLayersJson(),v.forEach(i=>{i.properties.layerControlExpand=!0,i.properties.layerControlToolsExpand=!0}),a.layers.push(...v)}r.push(a);const c=await K.getIndicatorLayers(e),u=K.getObservationPointsLayer(o);u&&a.layers.unshift(u);const y={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},s=c.filter(f=>f.properties.group==="baselayer");if(s.length){let f=0,v=0;for(let i=0;i<s.length;i++){const m=s[i];"visible"in m.properties||(m.properties.visible=!1),m.properties.visible&&(f++,v=i)}f===0&&(s[0].properties.visible=!0),f>0&&s.forEach((i,m)=>{m!==v?i.properties.visible=!1:i.properties.visible=!0}),y.layers.push(...s),y.layers.forEach(i=>{i.properties.layerControlExclusive=!0})}else y.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});y.layers.length&&r.push(y);const b={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},g=c.filter(f=>f.properties.group==="overlay");return g.length&&(b.layers.push(...g),r.unshift(b)),r};let A=null;const Oe=(e,o)=>{const p=r=>{var y;const a=r.map,c=(y=e.value)==null?void 0:y.lonLatCenter,u=a==null?void 0:a.getView().getZoom();c&&!Number.isNaN(c[0])&&!Number.isNaN(c[1])&&!Number.isNaN(u)&&(o.value=[c[0],c[1],u])};ae(()=>{var r,a;(a=(r=e.value)==null?void 0:r.map)==null||a.on("moveend",p)}),se(()=>{var r,a;(a=(r=e.value)==null?void 0:r.map)==null||a.un("moveend",p)})},oe=(e,o,p,r,a,c,u)=>{I.debug("InitMap",e.value,o.value,p.values,r.value);const y=we([o,r],async([s,b],[g,f])=>{var v,i,m,T,B,h,x,j,z,F,V,k,_,n,d,C;if(s){I.debug("Selected Indicator watch triggered",s,b),((v=e==null?void 0:e.value)==null?void 0:v.id)==="main"&&A!==null&&((i=e==null?void 0:e.value)==null||i.map.setView(A),A=null);let l=[];const S=(s==null?void 0:s.id)===(g==null?void 0:g.id)&&b!==f,{selectedCompareStac:L}=$(H());if(((m=e==null?void 0:e.value)==null?void 0:m.id)==="main"?await he(s):L.value!==null&&(A=((T=e==null?void 0:e.value)==null?void 0:T.map.getView())??null,e.value.sync=c.value),S){l=await ee(s,p,b),I.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(l))),a.value=l,Y(((B=e.value)==null?void 0:B.id)==="compare"?"compareTime:updated":"time:updated",e.value,l);return}l=await ee(s,p,r.value);let P=null;const J=(x=(h=s==null?void 0:s.extent)==null?void 0:h.temporal)==null?void 0:x.interval;if(J&&J.length>0&&J[0].length>1&&(P=new Date(J[0][1]),I.debug("Indicator load: found stac extent, setting time to latest value",P)),P!==null&&P.toISOString()!==r.value&&!q.value&&(r.value=P.toISOString()),u&&((j=e==null?void 0:e.value)==null?void 0:j.id)==="main"&&(z=s.extent)!=null&&z.spatial.bbox&&!(q.value&&((F=O.value)!=null&&F[0])&&((V=O.value)!=null&&V[1]))){const t=(k=s.extent)==null?void 0:k.spatial.bbox[0],ie=[(t==null?void 0:t[0])>-180?t==null?void 0:t[0]:-180,(t==null?void 0:t[1])>-90?t==null?void 0:t[1]:-90,(t==null?void 0:t[2])<180?t==null?void 0:t[2]:180,(t==null?void 0:t[3])<90?t==null?void 0:t[3]:90],ne=(d=e.value)==null?void 0:d.transformExtent(ie,"EPSG:4326",(n=(_=e.value)==null?void 0:_.map)==null?void 0:n.getView().getProjection());e.value.zoomExtent=ne}I.debug("Assigned layers",JSON.parse(JSON.stringify(l))),a.value=l,await Y(((C=e.value)==null?void 0:C.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,a.value)}},{immediate:!0});se(()=>{y()})},te=(e,o)=>{ye(async(p,r)=>{if(p.includes("compare"))return;const a=[];for(const c of e)a.push(...await c.getToolTipProperties());o.value=a,I.debug("Updated tooltip properties",o.value)})},Ie="#cursor-coordinates[data-v-1f91274c]{position:fixed;left:24px;bottom:56px;color:#000000e6;font-size:13px;background:#fffe;border-radius:4px;border:none;padding:4px 8px}#scale-line[data-v-1f91274c]{position:fixed;left:24px;bottom:24px;color:#fff}[data-v-1f91274c] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:4px 8px!important;font-size:12px!important;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif!important}[data-v-1f91274c] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important}.map-buttons-container[data-v-1f91274c]{position:fixed;top:0;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-1f91274c]>*{pointer-events:auto}",Le=[".enabled"],Me=[".center",".zoom",".layers",".controls"],Ne=[".propertyTransform"],Te=[".layers"],ke=[".propertyTransform"],_e={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Se={key:1,id:"scale-line",ref:"scale-line"};var re;const Be={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=O.value)==null?void 0:e[0])??15,((o=O.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((re=O.value)==null?void 0:re[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/8",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var _;const o=e,{width:p}=pe(),r=n=>{if(typeof n=="number")return n;if(typeof n=="string"){const d=n.split("/"),C=p.value;return C<960?parseInt(d[0])||1:C<1920?parseInt(d[1]||d[0])||1:parseInt(d[2]||d[1]||d[0])||1}return 1},a=w(()=>r(o.btnsPosition.x)),c=w(()=>r(o.btnsPosition.y)),u=w(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),y=Q("scale-line"),s=Q("cursor-coords"),b=M([]),g=M([]),f=w(()=>({Attribution:{collapsible:!0},ScaleLine:o.enableScaleLine?{target:y.value||void 0}:void 0,MousePosition:o.enableCursorCoordinates?{projection:"EPSG:4326",coordinateFormat:n=>`${n[1].toFixed(3)} °N, ${n[0].toFixed(3)} °E`,target:s.value||void 0}:void 0})),v=E(o.center),i=E(((_=O.value)==null?void 0:_[2])??o.zoom),m=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),T=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),B={duration:1200,easing:xe},h=M(null),x=M(null),{selectedCompareStac:j}=$(H()),z=w(()=>o.enableCompare&&j.value?"":"first");Oe(h,O),ae(()=>{const{selectedCompareStac:n,selectedStac:d}=$(H());ce.value=h.value,o.enableCompare&&(ue.value=x.value),o.enableCompare&&(oe(x,n,ge,X,T,h,!1),te(U,g)),oe(h,d,U,X,m,x,o.zoomToExtent)}),te(U,b);const F=w(()=>({visibility:b.value.length?"visible":"hidden"})),V=w(()=>({visibility:g.value.length?"visible":"hidden"})),k=n=>{const d=n==="main"?b:g,C=n=="main"?me:be;return l=>{const S=JSON.parse(ve.render(JSON.stringify(d.value),{...C.value??{}})),L=S==null?void 0:S.find(P=>P.id===l.key);if(L)return typeof l.value=="object"&&(l.value=JSON.stringify(l.value)),isNaN(Number(l.value))||(l.value=Number(l.value).toFixed(4).toString()),{key:L.title||L.id,value:l.value+" "+(L.appendix||"")}}};return(n,d)=>(Z(),D("span",null,[N("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":z.value},[N("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:h,id:"main",".animationOptions":B,".center":G(v),".zoom":G(i),".layers":m.value,".controls":f.value},[N("eox-map-tooltip",{style:R(F.value),".propertyTransform":k("main")},null,44,Ne)],40,Me),N("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:x,".layers":T.value},[N("eox-map-tooltip",{style:R(V.value),".propertyTransform":k("compare")},null,44,ke)],40,Te)],40,Le),e.enableCursorCoordinates?(Z(),D("div",_e,null,512)):W("v-if",!0),e.enableScaleLine?(Z(),D("span",Se,null,512)):W("v-if",!0),N("div",{class:"map-buttons-container",style:R(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0`)},[G(fe)||G(de)?(Z(),Pe(Ce,{key:0,style:R({gridColumn:a.value,gridRow:c.value}),exportMap:u.value.exportMap,changeProjection:u.value.changeProjection,compareIndicators:u.value.compareIndicators,backToPOIs:u.value.backToPOIs,enableSearch:u.value.enableSearch,enableZoom:u.value.enableZoom},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])):W("v-if",!0)],4)]))}},xo=le(Be,[["styles",[Ie]],["__scopeId","data-v-1f91274c"]]);export{xo as default};
